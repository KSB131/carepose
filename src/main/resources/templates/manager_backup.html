<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>관리자 대시보드</title>
<!-- Bootstrap 5 CSS -->
<link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
   rel="stylesheet" />
<link rel="stylesheet"
   href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
<!-- Custrom CSS (Optional, keeping if needed for specific overrides) -->
<link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body class="bg-light">
  <div class="container-fluid">
      <div class="row">
         <!-- Sidebar -->
         <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse p-0">
            <div class="position-sticky pt-4 px-3">
               <div class="sidebar-logo">
                  <div class="sidebar-title">SMHRD 요양병원</div>
                  <div class="sidebar-subtitle">안전 관제시스템</div>
               </div>
               <ul class="nav flex-column">
                  <li class="nav-item"><a class="nav-link"
                     th:href="@{/dashboard}"
                     th:classappend="${requestURI.contains('/dashboard')} ? 'active'">
                        <i class="bi bi-speedometer2 me-2"></i>대시보드
                  </a></li>
                  <li class="nav-item"><a class="nav-link"
                     th:href="@{/patients}"
                     th:classappend="${requestURI.contains('/patients')} ? 'active'">
                        <i class="bi bi-hospital me-2"></i>침상 관리
                  </a></li>
                  <li class="nav-item"><a class="nav-link" th:href="@{/rooms}"
                     th:classappend="${requestURI.contains('/rooms')} ? 'active'">
                        <i class="bi bi-camera-video me-2"></i>실시간 모니터링
                  </a></li>
                  <li class="nav-item"><a class="nav-link"
                     th:classappend="${requestURI.contains('/alerts')} ? 'active'">
                        <i class="bi bi-bell me-2"></i>알림 센터
                  </a></li>
                  <li class="nav-item"><a class="nav-link" th:href="@{/manager}"
                     th:classappend="${requestURI.contains('/manager')} ? 'active'">
                        <i class="bi bi-bell me-2"></i>관리자
                  </a></li>
               </ul>
               <div class="mt-5 px-3">
                  <span class="small text-muted" style="color: silver !important">carepose
                     1.0.0</span>
               </div>
            </div>
         </nav>
         
         <!-- Main Content -->
         <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="page-header d-flex align-items-center">
               <div>
                  <h1 class="page-title mb-1">관리자 대시보드</h1>
                  <p class="text-muted mb-0">직원 승인/삭제</p>
               </div>
            </div>
            
            <!-- Alerts Section -->
            <div class="row g-4">
               <div class="col-6">
                  <div class="card shadow-sm mb-4">
                     <div
                        class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                        <h5 class="mb-0 text-secondary">
                           최근 이벤트
                           <span id="todayBadge" class="badge bg-primary ms-2"></span>
                        </h5>
                     </div>
                     <div class="card-body p-0">
                        <!-- 신청 권한 박스 -->
                        <div class="row g-4">
						   <div class="col-12 col-xl-8"> <div class="card shadow-sm mb-4">
						         <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
						            <h5 class="mb-0 text-secondary">
						               <i class="bi bi-person-check me-2"></i>승인 대기 명단
						               <span class="badge bg-warning text-dark ms-2" th:text="${#lists.size(pendingMembers)}">0</span>
						            </h5>
						         </div>
						         <div class="card-body p-0">
						            <div class="table-responsive">
						               <table class="table table-hover align-middle mb-0">
						                  <thead class="table-light">
						                     <tr>
						                        <th class="ps-4">사용자명(ID)</th>
						                        <th>신청 권한</th>
						                        <th class="text-center">작업</th>
						                     </tr>
						                  </thead>
						                  <tbody>
						                     <tr th:each="member : ${pendingMembers}">
						                        <td class="ps-4">
						                           <span class="fw-bold" th:text="${member.username}">username</span>
						                        </td>
						                        <td>
						                           <span th:if="${member.roomAuthority == 'nurse'}" class="badge bg-info-subtle text-info px-3">간호사</span>
						                           <span th:if="${member.roomAuthority == 'caregiver'}" class="badge bg-success-subtle text-success px-3">요양보호사</span>
						                        </td>
						                        <td class="text-center">
						                           <button type="button" class="btn btn-sm btn-primary btn-approve" 
													        th:data-username="${member.username}" 
													        th:data-auth="${member.roomAuthority}">
													   <i class="bi bi-check-lg"></i> 승인
						                              </button>
						                              <button type="button" class="btn btn-sm btn-outline-danger btn-delete" 
													          th:data-username="${member.username}">
													     <i class="bi bi-trash"></i> 삭제
													  </button>
						                           </div>
						                        </td>
						                     </tr>
						                     <tr th:if="${#lists.isEmpty(pendingMembers)}">
						                        <td colspan="3" class="text-center py-5 text-muted">
						                           승인 대기 중인 인원이 없습니다.
						                        </td>
						                     </tr>
						                  </tbody>
						               </table>
						            </div>
						         </div>
						      </div>
						   </div>
						</div>
                     </div>
                  </div>
               </div>
            </div>
         </main>
         
    </div>
  </div>
  
  <script th:inline="javascript">
document.addEventListener('DOMContentLoaded', function() {
    
    // 승인 버튼 이벤트 리스너
    document.querySelectorAll('.btn-approve').forEach(button => {
        button.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            const auth = this.getAttribute('data-auth');
            const authName = (auth === 'nurse' ? '간호사' : '요양보호사');
            
            if(confirm(username + " 사용자를 " + authName + "(으)로 승인하시겠습니까?")) {
                location.href = "/manager/approve?username=" + username + "&role=" + auth;
            }
        });
    });

    // 삭제 버튼 이벤트 리스너
    document.querySelectorAll('.btn-delete').forEach(button => {
        button.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            
            if(confirm(username + " 사용자를 삭제하시겠습니까?")) {
                location.href = "/manager/delete?username=" + username;
            }
        });
    });
});
</script>

</body>
</html>